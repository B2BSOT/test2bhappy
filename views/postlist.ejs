<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>B2B사업팀 HappyDay</title>
    
    <script src="../../javascripts/jquery.js"></script>
    <script src="../../javascripts/jquery.min.js"></script>

    <link rel="stylesheet" type="text/css" href="/dist/semantic.min.css">
    <script src="/dist/semantic.min.js"></script>
    
<script type="text/javascript">
    function modalClose(){
   $('.ui.modal').modal('hide');
   //window.location.reload();
 }
        function goDetail(id) {
            location.href = '../../detail/' + id;
        }
        function goPostList(id) {
         // alert("aa");
            location.href = '../../detail/' + id + '/postlist';
        }
        
        // 조회 자바스크립트
        function showContent(post_id, happyday_id){
         // alert("aa");
         $.ajax({
         type: "post",
         url : "/postgetdata_KJB",
         data: {
         postid : post_id,
         happyID : happyday_id
         },
        success:function(data){ 
         
         var year =data.datas.modify_dtm.substring(0,4);
         var month = data.datas.modify_dtm.substring(4,6);
         var date = data.datas.modify_dtm.substring(6,8);
         var hour = data.datas.modify_dtm.substring(8,10);
         var minute = data.datas.modify_dtm.substring(10,12);
         var dtm = year + "." + month + "." + date + "  " + hour +":"+minute
    
      if("<%=session.user_name %>" == data.datas.user_name )
         {
          $('#happyday_post_update').show()
          $('#happyday_post_delete').show()
        } 
        else 
        {
          $('#happyday_post_update').hide()
          $('#happyday_post_delete').hide()
        }    
         $("#postselect_title").html(data.datas.post_title);
         $("#postselect_writer").html(data.datas.user_name);
         $("#postselect_time").html(dtm);
         $("#postselect_content").html(data.datas.post_content);
         $("#postselect_postid").val(data.datas.post_id);
         $("#postselect_happydayid").val(data.datas.happyday_id);
            $('.ui.modal.Select').modal('show');
        },
        error:function(e){  
            alert(e.responseText);  
        }  
      });
    }
    //업데이트 자바스크립트
     function PostUpdate() {
         var post_id = $("#postselect_postid").val();
         var happyday_id = $("#postselect_happydayid").val();
         $.ajax({
         type: "post",
         url : "/postgetdata_KJB",
         data: {
         postid : post_id,
         happyID : happyday_id
         },
        success:function(data){   
         $("#postupdate_title").val(data.datas.post_title);
         $("#postupdate_content").html(data.datas.post_content);
         $("#selectPostId").val(data.datas.post_id);
            $('.ui.modal.Update').modal('show');
        },
        error:function(e){  
            alert(e.responseText);  
        }  
      });   
    }
    //삭제 후기 자바스크립트
     function postDel() {
         var post_id = $("#postselect_postid").val();
        alert(post_id);
         $.ajax({
         type: "post",
         url : "/postdel_KJB",
         data: {
         postid : post_id
        //   happyID : happyday_id
         },
        success:function(data){   
         //화면 새로고침
            window.location.reload();
        },
        error:function(e){  
            alert(e.responseText);  
        }  
      });   
    }
    function PostReg(id) {
        $('.ui.modal.Reg').modal('show');
    }
    </script>
<style type="text/css">
        @ import ;
        body {
            font-family: 'Jeju Gothic', serif !important;
             padding-top: 80px;
        }
        .ui.card > .content > .header, .ui.cards > .card > .content > .header {
            display: block;
            font-family:  'Jeju Gothic', serif;
            color: rgba(0,0,0,.85);
        }
        .ui link cards {
            margin-top: 30p;
        }
        .navbar-inverse .navbar-brand {
            color: #ffffff;
        }
        .navbar-inverse .navbar-collapse,
        .navbar-inverse .navbar-form {
            border-color: #fff;
        }
        .navbar-inverse .navbar-toggle {
            border-color: #fff;
        }
        .navbar-inverse {
            background-color: #FFCC00;
            border-color: #FFCC00;
        }
</style>
</head>
<body>
<!-- Navigation -->
<% include ./partials/navigation.ejs %>
<!-- Page Content -->
<div class="ui container">
 <div class="content">
  <div class="header" href="#">
   <h1><%=data.happyday_name %></h1>
  </div>
  <div class="ui segment">
   <img class="ui centered fluid image" src=<%=data.img_url%> style="width:200px; height:200px">
   <div class="yellow two ui buttons">
    <button class="ui button" onclick="javascript:goDetail('<%=data.happyday_id%>')">상세보기</button>
    <!--<button class="ui button" onclick="javascript:PostReg('<%=data.happyday_id%>')">후기작성</button>-->
    <button class="ui button" onclick="javascript:goPostList('<%=data.happyday_id%>')">후기보기</button>
   </div>
   <p>
   </p>
   
   <!--post Reg Div default-->
   <div class="ui segment" onclick="javascript:PostReg('<%=data.happyday_id%>')">
   <i class="huge yellow add circle icon"></i>
   <font size="4"> 후기 등록을 해주세요 </font>
   </div>
  
   <!--show post list-->
   <% for (var i=0; i < postdata.length; i++) { %>
   <div class="ui segment" onclick=javascript:showContent("<%=postdata[i].post_id %>","<%=data.happyday_id %>")>
    <h3>
    <%=postdata[i].post_title %>
    <input type="hidden" value=<%=postdata[i].post_id %>> </h3>
    <p>
     <img class="ui avatar image" src="http://semantic-ui.com/images/avatar/large/elliot.jpg">
     <%=postdata[i].user_name %> (<%=postdata[i].sm_id %>)&nbsp;&nbsp;&nbsp;&nbsp; <%=postdata[i].date %>&nbsp;&nbsp;&nbsp;&nbsp; <i class="unhide icon"></i>
     <%=postdata[i].post_count %>
    </p>
   </div>
   <% } %>
  </div>
 </div>
</div>
<!--등록 모달 Start-->
<div class="ui modal Reg">
 <!--<form class="ui form segment" name="postregistmodal" action="/postregist_KJB" method="post">-->
 <form class="ui form segment" action="/postregist_KJB" method="post">
  <div class="header">
   <h1>후기 등록</h1>
  </div>
  <div class="content">
   <div class="field">
    <h3> 후기 title </h3>
    <div class="ui left icon input" style=" width: 100%;">
     <input type="text" name="post_title" placeholder="해피데이 후기 title" style="width: 100%" maxlength="20">
     <i class="user icon"></i>
    </div>
   </div>
   <div class="field">
    <h3>후기 내용</h3>
    <textarea name="post_content" style="width:100% ;height: 200px;" maxlength="700"></textarea>
   </div>
  </div>
  <div class="ui clearing divider">
  </div>
  <div class="ui error message">
  </div>
  <div class="actions">
   <button class="ui primary button"> Save </button>
   <div class="ui button" onclick=javascript:modalClose()>
     cancel
   </div>
  </div>
  <input type="hidden" name="happyID" value=<%=data.happyday_id %>>
 </form>
</div>
<!--등록모달 end-->
<!--조회모달 start-->
<form action="/postdel_KJB" method="post">
 <div class="ui modal Select">
  <div class="header">
   <h2 id='postselect_title'></h2>
   <input id='postselect_postid' type="hidden" value="">
   <input id='postselect_happydayid' type="hidden" value="">
  </div>
  <!-- modal header -->
  <div class="content">
   <div class="ui items">
    <div class="item">
     <div class="image">
      <img src=<%=data.img_url%>>
     </div>
     <div class="content">
      <a class="header" id="postselect_writer">작성자</a>
      <div class="meta">
       <span id="postselect_time">시간</span>
      </div>
      <div class="description">
       <p id="postselect_content">
         해피데이 내용
       </p>
      </div>
     </div>
    </div>
   </div>
  </div>
  <div class="actions">
   <button class="ui primary button" id="happyday_post_update" onclick=javascript:PostUpdate()> Update </button>
   <button class="negative ui button" id="happyday_post_delete" onclick=javascript:postDel()> Delete </button>
   <!--<button class="ui yellow submit approve button" id="submit" name="submit">regist</button>-->
   <div class="ui button" onclick=javascript:modalClose()>
     Cancel
   </div>
  </div>
 </div>
</form>
<!--조회 모달 end-->
</body>
</html>
<!--수정 모달 start-->
<div class="ui modal Update">
 <form class="ui form segment" name="postupdatemodal" action="/postupdate_KJB" method="post">
  <input id="selectPostId" name="postid" type="hidden" val="">
  <div class="header">
   <h1>후기 수정</h1>
  </div>
  <div class="content">
   <div class="column">
    <h3> 후기 title </h3>
    <div class="ui left icon input" style=" width: 100%;">
     <input type="text" id="postupdate_title" name="post_title" style="width: 100%" maxlength="20">
     <i class="user icon"></i>
    </div>
   </div>
   <h3>후기 내용</h3>
   <textarea id="postupdate_content" name="post_content" style="width:100% ;height: 200px;" maxlength="700"></textarea>
  </div>
  <div class="ui clearing divider">
  </div>
  <div class="actions">
   <button class="ui primary button"> Update </button>
   <div class="ui button" onclick=javascript:modalClose()>
     cancel
   </div>
  </div>
  <input type="hidden" name="happyID" value=<%=data.happyday_id %>>
 </form>
</div>
<!--수정모달 end --> 
 